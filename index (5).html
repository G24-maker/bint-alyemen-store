<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>متجر بنت اليمن | للأزياء والجمال</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Tajawal', sans-serif; }
        body { background-color: #fdf2f8; }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .gradient-text {
            background: linear-gradient(135deg, #be185d 0%, #9d174d 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .product-card {
            transition: all 0.3s ease;
        }
        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(190, 24, 93, 0.15);
        }
        .btn-primary {
            background: linear-gradient(135deg, #be185d 0%, #9d174d 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(190, 24, 93, 0.3);
        }
        .whatsapp-float {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .cart-drawer {
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        .cart-drawer.open {
            transform: translateX(0);
        }
        .upload-area {
            border: 3px dashed #e5e7eb;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .upload-area:hover, .upload-area.dragover {
            border-color: #be185d;
            background-color: #fdf2f8;
        }
        .upload-area.has-image {
            border-style: solid;
            border-color: #10b981;
            background-color: #ecfdf5;
        }
        .image-preview {
            max-height: 200px;
            object-fit: contain;
        }
        .new-badge {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            animation: badgePulse 2s infinite;
        }
        @keyframes badgePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .price-input::-webkit-inner-spin-button,
        .price-input::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .price-input {
            -moz-appearance: textfield;
        }

        /* ===== تنسيقات صور عالية الجودة ===== */
        .hd-image-container {
            position: relative;
            overflow: hidden;
            cursor: zoom-in;
        }
        .hd-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        .hd-image-container:hover .hd-image {
            transform: scale(1.15);
        }
        .zoom-icon {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.6);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .hd-image-container:hover .zoom-icon {
            opacity: 1;
        }

        /* ===== Lightbox ===== */
        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }
        .lightbox.active {
            display: flex;
        }
        .lightbox-img {
            max-width: 95%;
            max-height: 95%;
            object-fit: contain;
        }
        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 40px;
            color: white;
            font-size: 40px;
            cursor: pointer;
            z-index: 10000;
        }
        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-size: 30px;
            cursor: pointer;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            transition: background 0.3s;
        }
        .lightbox-nav:hover {
            background: rgba(255,255,255,0.3);
        }
        .lightbox-prev { left: 20px; }
        .lightbox-next { right: 20px; }

        /* ===== معرض الصور ===== */
        .gallery-main {
            position: relative;
            width: 100%;
            height: 400px;
            border-radius: 16px;
            overflow: hidden;
            cursor: pointer;
        }
        .gallery-main img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        .gallery-main:hover img {
            transform: scale(1.05);
        }
        .gallery-thumbs {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            overflow-x: auto;
            padding: 5px;
        }
        .gallery-thumb {
            min-width: 80px;
            height: 80px;
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        .gallery-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .gallery-thumb.active {
            border-color: #be185d;
            box-shadow: 0 0 0 3px rgba(190, 24, 93, 0.2);
        }
        .gallery-thumb:hover:not(.active) {
            border-color: #e5e7eb;
        }

        /* ===== صفحة تفاصيل المنتج ===== */
        .product-detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            overflow-y: auto;
        }
        .product-detail-modal.active {
            display: block;
        }
        .product-detail-content {
            background: white;
            max-width: 1200px;
            margin: 50px auto;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
        }

        /* ===== رفع متعدد الصور ===== */
        .multi-upload-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .preview-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #e5e7eb;
        }
        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .preview-item .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: red;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
        }
        .preview-item.main-image {
            border-color: #be185d;
            box-shadow: 0 0 0 3px rgba(190, 24, 93, 0.2);
        }
        .preview-item.main-image::after {
            content: 'رئيسية';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(190, 24, 93, 0.8);
            color: white;
            text-align: center;
            font-size: 10px;
            padding: 2px;
        }

        /* ===== Debug Info ===== */
        .debug-info {
            position: fixed;
            bottom: 100px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 8px;
            font-size: 12px;
            z-index: 9998;
            display: none;
        }

        /* ===== Admin Edit Modal ===== */
        .edit-product-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1001;
            justify-content: center;
            align-items: center;
            overflow-y: auto;
        }
        .edit-product-modal.active {
            display: flex;
        }
        .edit-product-content {
            background: white;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border-radius: 20px;
            padding: 30px;
            position: relative;
        }
    
        /* ===== قسم المنتجات الجديدة ===== */
        .new-products-banner {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            animation: pulse 2s infinite;
        }

        /* ===== Auto Add Badge ===== */
        .auto-badge {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }

    </style>
</head>
<body class="text-gray-800">
    <!-- Debug Info -->
    <div id="debug-info" class="debug-info"></div>

    <!-- Lightbox -->
    <div id="lightbox" class="lightbox" onclick="closeLightbox()">
        <span class="lightbox-close">×</span>
        <img id="lightbox-img" class="lightbox-img" src="" alt="صورة كبيرة">
        <button class="lightbox-nav lightbox-prev" onclick="event.stopPropagation(); changeLightboxImage(-1)">
            <i class="fa-solid fa-chevron-right"></i>
        </button>
        <button class="lightbox-nav lightbox-next" onclick="event.stopPropagation(); changeLightboxImage(1)">
            <i class="fa-solid fa-chevron-left"></i>
        </button>
    </div>

    <!-- نافذة تفاصيل المنتج -->
    <div id="product-detail-modal" class="product-detail-modal" onclick="closeProductDetail(event)">
        <div class="product-detail-content p-6 md:p-10" onclick="event.stopPropagation()">
            <button onclick="closeProductDetail()" class="absolute top-4 right-4 w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200 transition z-10">
                <i class="fa-solid fa-times text-xl"></i>
            </button>
            <div class="grid md:grid-cols-2 gap-8">
                <!-- معرض الصور -->
                <div>
                    <div class="gallery-main" onclick="openGalleryLightbox()">
                        <img id="detail-main-image" src="" alt="صورة المنتج الرئيسية">
                        <div class="zoom-icon">
                            <i class="fa-solid fa-expand"></i>
                        </div>
                    </div>
                    <div id="detail-gallery-thumbs" class="gallery-thumbs"></div>
                </div>
                <!-- تفاصيل المنتج -->
                <div class="flex flex-col justify-center">
                    <span id="detail-category" class="text-rose-600 font-medium mb-2"></span>
                    <h2 id="detail-name" class="text-3xl font-bold mb-4"></h2>
                    <p id="detail-price" class="text-4xl font-bold text-rose-600 mb-6"></p>
                    <p id="detail-description" class="text-gray-600 mb-8 leading-relaxed"></p>
                    <button id="detail-add-to-cart" class="btn-primary text-white py-4 rounded-xl font-bold text-lg">
                        <i class="fa-solid fa-cart-plus ml-2"></i> إضافة للسلة
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- نافذة تعديل المنتج (للإدارة) -->
    <div id="edit-product-modal" class="edit-product-modal" onclick="closeEditProductModal(event)">
        <div class="edit-product-content" onclick="event.stopPropagation()">
            <button onclick="closeEditProductModal()" class="absolute top-4 left-4 w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200 transition">
                <i class="fa-solid fa-times text-xl"></i>
            </button>
            <h3 class="text-2xl font-bold mb-6 text-gray-800">تعديل المنتج</h3>
            <form id="edit-product-form" class="space-y-4">
                <input type="hidden" id="edit-product-id">
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 mb-2">اسم المنتج *</label>
                        <input type="text" id="edit-product-name" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-rose-600 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">السعر (ر.ي) *</label>
                        <div class="relative">
                            <input type="number" id="edit-product-price" required min="0" step="1" class="price-input w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-rose-600 focus:outline-none pl-12">
                            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">ر.ي</span>
                        </div>
                    </div>
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">القسم *</label>
                    <select id="edit-product-category" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-rose-600 focus:outline-none">
                        <option value="أزياء يمنية">أزياء يمنية</option>
                        <option value="عبايات">عبايات</option>
                        <option value="فساتين">فساتين</option>
                        <option value="إكسسوارات">إكسسوارات</option>
                    </select>
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">الوصف</label>
                    <textarea id="edit-product-desc" rows="3" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-rose-600 focus:outline-none"></textarea>
                </div>
                
                <!-- تعديل الصور -->
                <div>
                    <label class="block text-gray-700 mb-2">صور المنتج</label>
                    <div id="edit-upload-section" class="upload-area rounded-xl p-6 text-center" onclick="document.getElementById('edit-file-input').click()">
                        <input type="file" id="edit-file-input" class="hidden" accept="image/*" multiple onchange="handleEditMultipleImages(this)">
                        <i class="fa-solid fa-images text-4xl text-gray-400 mb-3"></i>
                        <p class="text-gray-600 font-medium">اضغط هنا لإضافة صور جديدة</p>
                        <p class="text-gray-400 text-sm mt-1">يمكنك اختيار عدة صور مرة واحدة</p>
                    </div>
                    <div id="edit-multi-image-preview" class="multi-upload-preview"></div>
                    <p class="text-sm text-gray-500 mt-2">
                        <i class="fa-solid fa-info-circle ml-1"></i>
                        الصورة الأولى تكون الرئيسية. اضغط على الصورة لتعيينها كرئيسية.
                    </p>
                </div>

                <div class="flex gap-4 pt-4">
                    <button type="submit" class="flex-1 btn-primary text-white py-4 rounded-lg font-bold text-lg">
                        <i class="fa-solid fa-save ml-2"></i> حفظ التعديلات
                    </button>
                    <button type="button" onclick="closeEditProductModal()" class="px-6 py-4 rounded-lg font-bold text-gray-600 border border-gray-300 hover:bg-gray-100">
                        إلغاء
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="glass-effect fixed w-full z-50 top-0 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center cursor-pointer" onclick="showHome()">
                    <i class="fa-solid fa-crown text-rose-600 text-2xl ml-2"></i>
                    <span class="text-2xl font-bold gradient-text">بنت اليمن</span>
                </div>
                <div class="hidden md:flex space-x-8 space-x-reverse">
                    <button onclick="showHome()" class="nav-link text-gray-700 hover:text-rose-600 font-medium transition">الرئيسية</button>
                    <button onclick="showShop('all')" class="nav-link text-gray-700 hover:text-rose-600 font-medium transition">المتجر</button>
                    <button onclick="showCategories()" class="nav-link text-gray-700 hover:text-rose-600 font-medium transition">الأقسام</button>
                </div>
                <div class="flex items-center space-x-4 space-x-reverse">
                    <button onclick="toggleCart()" class="relative p-2 text-gray-700 hover:text-rose-600 transition">
                        <i class="fa-solid fa-cart-shopping text-xl"></i>
                        <span id="cart-count" class="absolute -top-1 -right-1 bg-rose-600 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center hidden">0</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div id="main-content" class="pt-16 min-h-screen">
        <!-- الصفحة الرئيسية -->
        <div id="home-page" class="fade-in">
            <!-- Hero Section -->
            <div class="relative bg-gradient-to-br from-rose-50 to-pink-100 py-20 px-4">
                <div class="max-w-7xl mx-auto grid md:grid-cols-2 gap-12 items-center">
                    <div class="text-center md:text-right">
                        <h1 class="text-4xl md:text-6xl font-bold mb-6 leading-tight">
                            أزياء يمنية بأناقة
                            <span class="gradient-text">عصرية</span>
                        </h1>
                        <p class="text-gray-600 text-lg mb-8 leading-relaxed">
                            اكتشفي تشكيلتنا الفريدة من الأزياء اليمنية الأصيلة والعبايات الفاخرة بأعلى جودة
                        </p>
                        <div class="flex flex-col sm:flex-row gap-4 justify-center md:justify-start">
                            <button onclick="showShop('all')" class="btn-primary text-white px-8 py-4 rounded-full font-bold text-lg">
                                تسوقي الآن <i class="fa-solid fa-arrow-left mr-2"></i>
                            </button>
                        </div>
                    </div>
                    <div class="relative">
                        <div class="absolute inset-0 bg-rose-200 rounded-full filter blur-3xl opacity-30"></div>
                        <img src="https://images.unsplash.com/photo-1595777457583-95e059d581b8?w=1200&h=1500&fit=crop&q=100" alt="Fashion" class="relative rounded-3xl shadow-2xl w-full h-[500px] object-cover cursor-pointer" onclick="openLightbox(this.src)">
                    </div>
                </div>
            </div>

            <!-- المنتجات الجديدة -->
            <div id="new-products-section" class="hidden py-16 px-4 bg-gradient-to-br from-green-50 to-emerald-100">
                <div class="max-w-7xl mx-auto">
                    <div class="flex items-center gap-3 mb-8">
                        <span class="new-badge text-white px-4 py-2 rounded-full font-bold text-sm">جديد</span>
                        <h2 class="text-3xl font-bold gradient-text">وصل حديثاً</h2>
                    </div>
                    <div id="new-products" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
                </div>
            </div>

            <!-- Featured Products -->
            <div class="py-16 px-4 bg-gray-50">
                <div class="max-w-7xl mx-auto">
                    <h2 class="text-3xl font-bold text-center mb-12 gradient-text">منتجات مميزة</h2>
                    <div id="featured-products" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
                </div>
            </div>

            <!-- جميع المنتجات -->
            <div class="py-16 px-4 bg-white">
                <div class="max-w-7xl mx-auto">
                    <h2 class="text-3xl font-bold text-center mb-12 gradient-text">جميع منتجاتنا</h2>
                    <div id="all-home-products" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
                    <div class="text-center mt-8">
                        <button onclick="showShop('all')" class="btn-primary text-white px-8 py-4 rounded-full font-bold text-lg">
                            عرض جميع المنتجات <i class="fa-solid fa-arrow-left mr-2"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- صفحة المتجر -->
        <div id="shop-page" class="hidden fade-in py-8 px-4">
            <div class="max-w-7xl mx-auto">
                <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                    <h2 class="text-3xl font-bold gradient-text">جميع المنتجات</h2>
                    <div class="flex gap-2 flex-wrap justify-center">
                        <button onclick="filterProducts('all')" class="category-btn px-4 py-2 rounded-full bg-rose-600 text-white font-medium" data-category="all">الكل</button>
                        <button onclick="filterProducts('أزياء يمنية')" class="category-btn px-4 py-2 rounded-full bg-white text-gray-700 border border-gray-300 hover:border-rose-600" data-category="أزياء يمنية">أزياء يمنية</button>
                        <button onclick="filterProducts('عبايات')" class="category-btn px-4 py-2 rounded-full bg-white text-gray-700 border border-gray-300 hover:border-rose-600" data-category="عبايات">عبايات</button>
                        <button onclick="filterProducts('فساتين')" class="category-btn px-4 py-2 rounded-full bg-white text-gray-700 border border-gray-300 hover:border-rose-600" data-category="فساتين">فساتين</button>
                        <button onclick="filterProducts('إكسسوارات')" class="category-btn px-4 py-2 rounded-full bg-white text-gray-700 border border-gray-300 hover:border-rose-600" data-category="إكسسوارات">إكسسوارات</button>
                    </div>
                </div>
                <div id="shop-products" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
            </div>
        </div>

        <!-- صفحة إتمام الطلب -->
        <div id="checkout-page" class="fade-in py-8 px-4 hidden">
            <div class="max-w-3xl mx-auto">
                <h2 class="text-3xl font-bold text-center mb-8 gradient-text">إتمام الطلب</h2>
                <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">ملخص الطلب</h3>
                    <div id="checkout-items" class="space-y-4 mb-6"></div>
                    <div class="border-t pt-4">
                        <div class="flex justify-between items-center text-xl font-bold">
                            <span>الإجمالي:</span>
                            <span id="checkout-total" class="text-rose-600">٠ ر.ي</span>
                        </div>
                    </div>
                </div>
                <form id="checkout-form" class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">معلومات التوصيل</h3>
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-700 mb-2">الاسم الكامل *</label>
                            <input type="text" id="customer-name" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-rose-600 focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">رقم الجوال *</label>
                            <input type="tel" id="customer-phone" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-rose-600 focus:outline-none">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">المدينة *</label>
                        <select id="customer-city" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-rose-600 focus:outline-none">
                            <option value="">اختر المدينة</option>
                            <option value="صنعاء">صنعاء</option>
                            <option value="عدن">عدن</option>
                            <option value="تعز">تعز</option>
                            <option value="الحديدة">الحديدة</option>
                            <option value="إب">إب</option>
                            <option value="المكلا">المكلا</option>
                        </select>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 mb-2">ملاحظات (اختياري)</label>
                        <textarea id="customer-notes" rows="3" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-rose-600 focus:outline-none"></textarea>
                    </div>
                    <button type="submit" class="w-full btn-primary text-white py-4 rounded-lg font-bold text-lg">
                        <i class="fa-brands fa-whatsapp ml-2"></i> إرسال الطلب عبر واتساب
                    </button>
                </form>
            </div>
        </div>

        <!-- صفحة تسجيل دخول الإدارة -->
        <div id="admin-login-page" class="hidden fade-in min-h-screen flex items-center justify-center bg-gradient-to-br from-rose-50 to-pink-100">
            <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md mx-4">
                <div class="text-center mb-8">
                    <i class="fa-solid fa-lock text-rose-600 text-5xl mb-4"></i>
                    <h2 class="text-2xl font-bold text-gray-800">لوحة الإدارة</h2>
                    <p class="text-gray-500">الرجاء إدخال كلمة المرور للمتابعة</p>
                </div>
                <form id="admin-login-form">
                    <div class="mb-6">
                        <label class="block text-gray-700 mb-2">كلمة المرور</label>
                        <input type="password" id="admin-password" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-rose-600 focus:outline-none text-center text-xl tracking-widest">
                    </div>
                    <button type="submit" class="w-full btn-primary text-white py-3 rounded-lg font-bold">دخول</button>
                    <button type="button" onclick="showHome()" class="w-full mt-3 py-3 rounded-lg font-bold text-gray-600 hover:text-gray-800">رجوع للرئيسية</button>
                </form>
            </div>
        </div>

        <!-- صفحة لوحة الإدارة -->
        <div id="admin-dashboard" class="hidden fade-in">
            <div class="bg-rose-600 text-white py-6 px-4">
                <div class="max-w-7xl mx-auto flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold">لوحة تحكم المتجر</h2>
                        <p class="text-rose-200">إدارة المنتجات والإعدادات</p>
                    </div>
                    <button onclick="adminLogout()" class="bg-white text-rose-600 px-4 py-2 rounded-lg font-bold hover:bg-rose-50 transition">
                        <i class="fa-solid fa-sign-out-alt ml-2"></i> خروج
                    </button>
                </div>
            </div>
            <div class="max-w-7xl mx-auto p-4 py-8">
                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500">إجمالي المنتجات</p>
                                <p id="admin-products-count" class="text-3xl font-bold text-gray-800">0</p>
                            </div>
                            <i class="fa-solid fa-box text-rose-600 text-3xl"></i>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500">الطلبات الجديدة</p>
                                <p id="admin-orders-count" class="text-3xl font-bold text-gray-800">0</p>
                            </div>
                            <i class="fa-solid fa-shopping-bag text-rose-600 text-3xl"></i>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500">إجمالي المبيعات</p>
                                <p id="admin-sales-total" class="text-3xl font-bold text-gray-800">0 ر.ي</p>
                            </div>
                            <i class="fa-solid fa-money-bill-wave text-rose-600 text-3xl"></i>
                        </div>
                    </div>
                </div>

                <!-- إدارة الإعدادات -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">إعدادات المتجر</h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 mb-2">رقم واتساب</label>
                            <input type="text" id="settings-whatsapp" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-rose-600 focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">كلمة مرور جديدة</label>
                            <input type="password" id="settings-password" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-rose-600 focus:outline-none">
                        </div>
                    </div>
                    <button onclick="saveSettings()" class="mt-4 bg-rose-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-rose-700 transition">
                        <i class="fa-solid fa-save ml-2"></i> حفظ الإعدادات
                    </button>
                </div>

                <!-- إدارة المنتجات -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800">إدارة المنتجات</h3>
                        <div class="flex gap-2">
                            <button onclick="triggerManualAutoAdd()" class="bg-blue-500 text-white px-4 py-2 rounded-lg font-bold hover:bg-blue-600 transition" title="إضافة منتجات تلقائية يدوياً">
                                <i class="fa-solid fa-robot ml-2"></i> إضافة تلقائية
                            </button>
                            <button onclick="showAddProductForm()" class="bg-green-500 text-white px-4 py-2 rounded-lg font-bold hover:bg-green-600 transition">
                                <i class="fa-solid fa-plus ml-2"></i> إضافة منتج
                            </button>
                        </div>
                    </div>
                    <div id="admin-products-list" class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-right">المنتج</th>
                                    <th class="px-4 py-3 text-right">القسم</th>
                                    <th class="px-4 py-3 text-right">السعر</th>
                                    <th class="px-4 py-3 text-right">الصور</th>
                                    <th class="px-4 py-3 text-right">تاريخ الإضافة</th>
                                    <th class="px-4 py-3 text-right">النوع</th>
                                    <th class="px-4 py-3 text-right">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="admin-products-table"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- نموذج إضافة منتج جديد مع دعم متعدد الصور -->
    <div id="add-product-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[95vh] overflow-y-auto">
            <div class="p-6 border-b flex justify-between items-center sticky top-0 bg-white">
                <h3 class="text-xl font-bold">إضافة منتج جديد</h3>
                <button onclick="closeAddProductModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fa-solid fa-times text-xl"></i>
                </button>
            </div>
            <form id="add-product-form" class="p-6 space-y-4">
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 mb-2">اسم المنتج *</label>
                        <input type="text" id="new-product-name" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-rose-600 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">السعر (ر.ي) *</label>
                        <div class="relative">
                            <input type="number" id="new-product-price" required min="0" step="1" class="price-input w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-rose-600 focus:outline-none pl-12" placeholder="أدخل السعر بالأرقام">
                            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">ر.ي</span>
                        </div>
                    </div>
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">القسم *</label>
                    <select id="new-product-category" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-rose-600 focus:outline-none">
                        <option value="أزياء يمنية">أزياء يمنية</option>
                        <option value="عبايات">عبايات</option>
                        <option value="فساتين">فساتين</option>
                        <option value="إكسسوارات">إكسسوارات</option>
                    </select>
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">الوصف</label>
                    <textarea id="new-product-desc" rows="3" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-rose-600 focus:outline-none"></textarea>
                </div>

                <!-- رفع متعدد الصور -->
                <div>
                    <label class="block text-gray-700 mb-2">صور المنتج * (يمكن اختيار عدة صور)</label>

                    <div id="upload-section-1" class="upload-area rounded-xl p-6 text-center" onclick="document.getElementById('file-input').click()">
                        <input type="file" id="file-input" class="hidden" accept="image/*" multiple onchange="handleMultipleImages(this)">
                        <i class="fa-solid fa-images text-4xl text-gray-400 mb-3"></i>
                        <p class="text-gray-600 font-medium">اضغط هنا لاختيار الصور</p>
                        <p class="text-gray-400 text-sm mt-1">يمكنك اختيار عدة صور مرة واحدة</p>
                        <p class="text-gray-400 text-xs mt-2">الصيغ: JPG, PNG | الحد: 5MB للصورة</p>
                    </div>

                    <!-- معاينة الصور المتعددة -->
                    <div id="multi-image-preview" class="multi-upload-preview"></div>

                    <p class="text-sm text-gray-500 mt-2">
                        <i class="fa-solid fa-info-circle ml-1"></i>
                        الصورة الأولى تكون الرئيسية. اضغط على الصورة لتعيينها كرئيسية.
                    </p>
                </div>

                <button type="submit" class="w-full btn-primary text-white py-4 rounded-lg font-bold text-lg mt-6">
                    <i class="fa-solid fa-plus ml-2"></i> إضافة المنتج
                </button>
            </form>
        </div>
    </div>

    <!-- سلة المشتريات -->
    <div id="cart-overlay" class="fixed inset-0 bg-black/50 z-50 hidden" onclick="toggleCart()"></div>
    <div id="cart-drawer" class="cart-drawer fixed top-0 right-0 h-full w-full max-w-md bg-white z-50 shadow-2xl flex flex-col">
        <div class="p-6 border-b flex justify-between items-center">
            <h3 class="text-xl font-bold">سلة المشتريات</h3>
            <button onclick="toggleCart()" class="text-gray-500 hover:text-gray-700">
                <i class="fa-solid fa-times text-xl"></i>
            </button>
        </div>
        <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-4">
            <div class="text-center text-gray-500 py-12">
                <i class="fa-solid fa-cart-shopping text-6xl mb-4 text-gray-300"></i>
                <p>السلة فارغة</p>
            </div>
        </div>
        <div class="border-t p-6 space-y-4">
            <div class="flex justify-between items-center text-xl font-bold">
                <span>الإجمالي:</span>
                <span id="cart-total">٠ ر.ي</span>
            </div>
            <button onclick="showCheckout()" id="checkout-btn" class="w-full py-3 rounded-lg font-bold bg-gray-300 text-gray-500 cursor-not-allowed" disabled>إتمام الطلب</button>
            <button onclick="clearCart()" id="clear-cart-btn" class="w-full border border-red-500 text-red-500 py-3 rounded-lg font-bold hover:bg-red-50 transition hidden">إفراغ السلة</button>
        </div>
    </div>

    <!-- واتساب عائم -->
    <a href="https://wa.me/967783144581" target="_blank" rel="noreferrer" class="whatsapp-float fixed bottom-6 left-6 z-40 bg-green-500 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center hover:bg-green-600 transition">
        <i class="fa-brands fa-whatsapp text-3xl"></i>
    </a>

    <!-- Footer -->
    <footer class="bg-white border-t py-12 mt-12">
        <div class="max-w-7xl mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-8 text-center md:text-right">
            <div>
                <h3 class="text-xl font-bold mb-4 text-rose-600">بنت اليمن</h3>
                <p class="text-gray-500 text-sm">متجرك الأول للأزياء اليمنية الراقية والعبايات العصرية.</p>
            </div>
            <div>
                <h4 class="font-bold mb-4 text-sm uppercase tracking-widest text-gray-400">روابط سريعة</h4>
                <ul class="space-y-2 text-sm text-gray-600">
                    <li><button onclick="showHome()" class="hover:text-rose-600">الرئيسية</button></li>
                    <li><button onclick="showShop('all')" class="hover:text-rose-600">المتجر</button></li>
                </ul>
            </div>
            <div>
                <h4 class="font-bold mb-4 text-sm uppercase tracking-widest text-gray-400">تواصلوا معنا</h4>
                <div class="flex justify-center md:justify-end gap-4 text-rose-600">
                    <a href="#" class="hover:scale-110 transition"><i class="fa-brands fa-instagram text-xl"></i></a>
                    <a href="#" class="hover:scale-110 transition"><i class="fa-brands fa-tiktok text-xl"></i></a>
                    <a href="#" class="hover:scale-110 transition"><i class="fa-brands fa-snapchat text-xl"></i></a>
                </div>
            </div>
        </div>
        <div class="mt-8 text-center text-sm text-gray-400">جميع الحقوق محفوظة لمتجر بنت اليمن © 2024</div>
    </footer>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-24 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg z-50 hidden">
        <span id="toast-message">تم إرسال طلبك! سنتواصل معك قريباً ✓</span>
    </div>

    <!-- تحميل ملف المنتجات -->
    <script src="products.js"></script>

    <script>
        // ==================== البيانات والإعدادات ====================
        const STORE_NAME = 'متجر بنت اليمن';
        let WHATSAPP_NUMBER = '967783144581';
        let ADMIN_PASSWORD = '1234';
        let CURRENCY = 'ر.ي';

        // ✅ المتغير العالمي للمنتجات - يتم تحديثه من localStorage
        let products = [];

        let cart = [];
        let currentCategory = 'all';
        let currentLightboxImages = [];
        let currentLightboxIndex = 0;
        let tempProductImages = [];
        let editProductImages = [];
        let currentEditProductId = null;

        
        // ==================== نظام الإضافة التلقائية اليومية ====================

        // قواعد بيانات المنتجات للتوليد التلقائي
        const AUTO_PRODUCT_NAMES = {
            'أزياء يمنية': [
                'درع صنعاني ملكي', 'ثوب يمني تقليدي', 'زي صنعاني نسائي', 'لباس حضرمي فاخر',
                'ثوب تعزي مطرز', 'زي يمني زفافي', 'درع حديدة أصيل', 'ثوب إب الفاخر',
                'زي المكلا التقليدي', 'ثوب عدني ملكي', 'درع صعدة الأصيل', 'زي رداع الفاخر',
                'ثوب مارب التقليدي', 'زي الجوف الأصيل', 'درع المحويت الفاخر', 'ثوب ذمار الأنيق',
                'زي البيضاء التقليدي', 'درع شبوة الفاخر', 'ثوب أبين الأصيل', 'زي لحج التقليدي',
                'درع الضالع الفاخر', 'ثوب صنعاء الملكي', 'زي تعزي زفافي', 'درع حضرمي ملكي'
            ],
            'عبايات': [
                'عباية مخملية سوداء', 'عباية حريرية ذهبية', 'عباية سوداء كلاسيكية', 'عباية مطرزة فاخرة',
                'عباية كريب ناعمة', 'عباية شيفون فاخرة', 'عباية ساتان لامعة', 'عباية قطيفة شتوية',
                'عباية لينن صيفية', 'عباية دانتيل أنيقة', 'عباية مخملية زرقاء', 'عباية حمراء جذابة',
                'عباية بيج ناعمة', 'عباية رمادية عصرية', 'عباية وردية أنثوية', 'عباية خضراء زيتونية'
            ],
            'فساتين': [
                'فستان زفاف مودرن', 'فستان سهرة أحمر', 'فستان كوكتيل قصير', 'فستان خطوبة فاخر',
                'فستان سهرة أسود', 'فستان زفاف دانتيل', 'فستان سهرة ذهبي', 'فستان كاجوال صيفي',
                'فستان عملي مكتبي', 'فستان سهرة فضي', 'فستان زفاف بسيط', 'فستان سهرة أزرق',
                'فستان كوكتيل وردي', 'فستان خطوبة أحمر', 'فستان سهرة أخضر', 'فستان زفاف ملكي'
            ],
            'إكسسوارات': [
                'عقد فضة يمني قديم', 'سوار ذهبي فاخر', 'حلق فضي مطرز', 'خاتم زمرد يمني',
                'عقود تراثية متعددة', 'تاج كريستالي فاخر', 'مشبك شعر ذهبي', 'طقم مجوهرات كامل',
                'عقد لؤلؤ طبيعي', 'سوار فضي منقوش', 'حلق ذهبي مرصع', 'خاتم ذهبي عيار 21',
                'عقد ياقوت يمني', 'تاج زفاف ملكي', 'مشبك شعر فضي', 'طقم فضة يمني'
            ]
        };

        const AUTO_PRODUCT_DESCRIPTIONS = {
            'أزياء يمنية': [
                'قطعة أصيلة من التراث اليمني العريق، مصنوعة بأجود الخامات',
                'تصميم تقليدي يمني بلمسة عصرية أنيقة',
                'قماش حريري طبيعي بتطريز يدوي رائع',
                'إطلالة يمنية أصيلة تناسب جميع المناسبات'
            ],
            'عبايات': [
                'عباية فاخرة بتصميم عصري وأنيق',
                'قماش عالي الجودة مع تفاصيل راقية',
                'تصميم محتشم يناسب جميع المناسبات',
                'أناقة وراحة في قطعة واحدة فاخرة'
            ],
            'فساتين': [
                'فستان أنيق يناسب جميع المناسبات',
                'تصميم راقي مع تفاصيل جذابة',
                'قماش فاخر يمنحك إطلالة مميزة',
                'فستان عصري بألوان جذابة'
            ],
            'إكسسوارات': [
                'إكسسوار فاخر يكمل إطلالتك',
                'تصميم أنيق يناسب جميع الأذواق',
                'صناعة يدوية بدقة عالية',
                'قطعة فريدة تضيف لمسة جمالية'
            ]
        };

        const AUTO_PRODUCT_IMAGES = {
            'أزياء يمنية': [
                'https://images.unsplash.com/photo-1558171813-4c088753af8f?w=800&h=1000&fit=crop&q=80',
                'https://images.unsplash.com/photo-1595777457583-95e059d581b8?w=800&h=1000&fit=crop&q=80',
                'https://images.unsplash.com/photo-1566174053879-31528523f8ae?w=800&h=1000&fit=crop&q=80',
                'https://images.unsplash.com/photo-1535632066927-ab7c9ab60908?w=800&h=1000&fit=crop&q=80'
            ],
            'عبايات': [
                'https://images.unsplash.com/photo-1595777457583-95e059d581b8?w=800&h=1000&fit=crop&q=80',
                'https://images.unsplash.com/photo-1539008835657-9e8e9680c956?w=800&h=1000&fit=crop&q=80',
                'https://images.unsplash.com/photo-1566174053879-31528523f8ae?w=800&h=1000&fit=crop&q=80',
                'https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?w=800&h=1000&fit=crop&q=80'
            ],
            'فساتين': [
                'https://images.unsplash.com/photo-1566174053879-31528523f8ae?w=800&h=1000&fit=crop&q=80',
                'https://images.unsplash.com/photo-1595777457583-95e059d581b8?w=800&h=1000&fit=crop&q=80',
                'https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?w=800&h=1000&fit=crop&q=80',
                'https://images.unsplash.com/photo-1496747611176-843222e1e57c?w=800&h=1000&fit=crop&q=80'
            ],
            'إكسسوارات': [
                'https://images.unsplash.com/photo-1535632066927-ab7c9ab60908?w=800&h=1000&fit=crop&q=80',
                'https://images.unsplash.com/photo-1594633312681-425c7b97ccd1?w=800&h=1000&fit=crop&q=80',
                'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=800&h=1000&fit=crop&q=80',
                'https://images.unsplash.com/photo-1573408301185-9146fe634ad0?w=800&h=1000&fit=crop&q=80'
            ]
        };

        const AUTO_PRICE_RANGES = {
            'أزياء يمنية': { min: 8000, max: 25000 },
            'عبايات': { min: 10000, max: 55000 },
            'فساتين': { min: 12000, max: 65000 },
            'إكسسوارات': { min: 4500, max: 45000 }
        };

        // دالة توليد رقم عشوائي
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // دالة اختيار عنصر عشوائي
        function getRandomItem(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        // دالة توليد سعر عشوائي
        function generateAutoPrice(category) {
            const range = AUTO_PRICE_RANGES[category];
            const price = getRandomInt(range.min, range.max);
            return Math.round(price / 500) * 500;
        }

        // دالة توليد منتج عشوائي
        function generateAutoProduct(category = null) {
            const categories = Object.keys(AUTO_PRODUCT_NAMES);
            const selectedCategory = category || getRandomItem(categories);

            const name = getRandomItem(AUTO_PRODUCT_NAMES[selectedCategory]);
            const description = getRandomItem(AUTO_PRODUCT_DESCRIPTIONS[selectedCategory]);
            const image = getRandomItem(AUTO_PRODUCT_IMAGES[selectedCategory]);
            const price = generateAutoPrice(selectedCategory);

            return {
                id: 'auto_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                name: name,
                price: price,
                description: description,
                images: [image],
                category: selectedCategory,
                createdAt: new Date().toISOString(),
                isAutoGenerated: true
            };
        }

        // دالة توليد مجموعة منتجات عشوائية
        function generateAutoProducts(count) {
            const newProducts = [];
            for (let i = 0; i < count; i++) {
                newProducts.push(generateAutoProduct());
            }
            return newProducts;
        }

        // دالة التحقق من الإضافة اليومية
        function checkDailyAutoAdd() {
            const lastAddDate = localStorage.getItem('yaman_last_auto_add_date');
            const today = new Date().toDateString();

            if (lastAddDate !== today) {
                console.log('🔄 يوم جديد - جاري إضافة منتجات تلقائية...');
                return true;
            }
            console.log('✅ تمت الإضافة اليومية مسبقاً');
            return false;
        }

        // دالة تحديث تاريخ آخر إضافة
        function updateLastAddDate() {
            localStorage.setItem('yaman_last_auto_add_date', new Date().toDateString());
        }

        // دالة الحصول على عدد المنتجات للإضافة اليومية
        function getDailyAddCount() {
            return getRandomInt(10, 20);
        }

        // دالة تنفيذ الإضافة التلقائية اليومية
        function executeDailyAutoAdd() {
            if (!checkDailyAutoAdd()) {
                return [];
            }

            const count = getDailyAddCount();
            console.log(`🆕 جاري إضافة ${count} منتج جديد تلقائياً...`);

            const newProducts = generateAutoProducts(count);
            products = [...newProducts, ...products];
            saveProductsToStorage();

            updateLastAddDate();

            console.log(`✅ تم إضافة ${count} منتج جديد تلقائياً`);
            showToast(`تم إضافة ${count} منتج جديد تلقائياً ✓`);

            return newProducts;
        }

        // دالة الإضافة اليدوية (للاختبار)
        function triggerManualAutoAdd() {
            const count = getDailyAddCount();
            const newProducts = generateAutoProducts(count);
            products = [...newProducts, ...products];
            saveProductsToStorage();

            renderAdminProducts();
            updateAdminStats();

            showToast(`تم إضافة ${count} منتج جديد يدوياً ✓`);
            console.log(`✅ تم إضافة ${count} منتج يدوياً`);
        }

        // ==================== عرض المنتجات الجديدة اليومية ====================
        function renderDailyNewProducts() {
            const section = document.getElementById('daily-new-products-section');
            const container = document.getElementById('daily-new-products');
            const countLabel = document.getElementById('new-products-count');

            if (!section || !container) return;

            const now = new Date();
            const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());

            const todayProducts = products.filter(p => {
                const productDate = new Date(p.createdAt);
                return productDate >= todayStart;
            });

            if (todayProducts.length > 0) {
                section.classList.remove('hidden');
                container.innerHTML = todayProducts.map(createProductCard).join('');
                if (countLabel) {
                    countLabel.textContent = `${todayProducts.length} منتج جديد اليوم`;
                }
                console.log('✅ تم عرض المنتجات الجديدة اليوم:', todayProducts.length, 'منتج');
            } else {
                section.classList.add('hidden');
            }
        }

        // ==================== عرض المنتجات المضافة تلقائياً ====================
        function renderAutoProducts() {
            const section = document.getElementById('auto-products-section');
            const container = document.getElementById('auto-products');

            if (!section || !container) return;

            const autoProducts = products.filter(p => p.isAutoGenerated === true).slice(0, 8);

            if (autoProducts.length > 0) {
                section.classList.remove('hidden');
                container.innerHTML = autoProducts.map(createProductCard).join('');
                console.log('✅ تم عرض المنتجات التلقائية:', autoProducts.length, 'منتج');
            } else {
                section.classList.add('hidden');
            }
        }


// ==================== دالة تحميل المنتجات من التخزين ====================
        function loadProductsFromStorage() {
            console.log('🔄 جاري تحميل المنتجات...');

            const savedProducts = localStorage.getItem('yaman_products');
            const savedCart = localStorage.getItem('yaman_cart');

            if (savedCart) {
                try {
                    cart = JSON.parse(savedCart);
                    console.log('✅ تم تحميل السلة:', cart.length, 'منتج');
                } catch (e) {
                    console.error('❌ خطأ في تحميل السلة:', e);
                    cart = [];
                }
            }

            // ⚠️ دائماً نبدأ بالمنتجات الافتراضية أولاً
            console.log('⚠️ تحميل المنتجات الافتراضية...');

            // المنتجات الافتراضية المدمجة مباشرة في الكود
            const defaultProducts = [
                {
                    id: '1',
                    name: 'درع صنعاني ملكي',
                    price: 15000,
                    description: 'درع صنعاني أصيل مطرز بخيوط الذهب، قماش حرير طبيعي عالي الجودة.',
                    images: ['https://images.unsplash.com/photo-1558171813-4c088753af8f?w=800&h=1000&fit=crop&q=80'],
                    category: 'أزياء يمنية',
                    createdAt: '2024-01-01T00:00:00.000Z',
                    isAutoGenerated: false
                },
                {
                    id: '2',
                    name: 'ثوب يمني تقليدي',
                    price: 8500,
                    description: 'ثوب يمني أصيل بتصميم تقليدي، قماش قطني فاخر ومريح.',
                    images: ['https://images.unsplash.com/photo-1595777457583-95e059d581b8?w=800&h=1000&fit=crop&q=80'],
                    category: 'أزياء يمنية',
                    createdAt: '2024-01-02T00:00:00.000Z',
                    isAutoGenerated: false
                },
                {
                    id: '3',
                    name: 'زي صنعاني نسائي',
                    price: 12000,
                    description: 'زي صنعاني نسائي أصيل بتطريز يدوي رائع، مناسب للمناسبات الخاصة.',
                    images: ['https://images.unsplash.com/photo-1566174053879-31528523f8ae?w=800&h=1000&fit=crop&q=80'],
                    category: 'أزياء يمنية',
                    createdAt: '2024-01-03T00:00:00.000Z',
                    isAutoGenerated: false
                },
                {
                    id: '4',
                    name: 'لباس حضرمي فاخر',
                    price: 18000,
                    description: 'لباس حضرمي فاخر بتصميم أصيل، قماش حريري بلمعة رائعة.',
                    images: ['https://images.unsplash.com/photo-1535632066927-ab7c9ab60908?w=800&h=1000&fit=crop&q=80'],
                    category: 'أزياء يمنية',
                    createdAt: '2024-01-04T00:00:00.000Z',
                    isAutoGenerated: false
                },
                {
                    id: '5',
                    name: 'ثوب تعزي مطرز',
                    price: 9500,
                    description: 'ثوب تعزي أصيل بتطريز يدوي دقيق، يعكس تراث تعز العريق.',
                    images: ['https://images.unsplash.com/photo-1594633312681-425c7b97ccd1?w=800&h=1000&fit=crop&q=80'],
                    category: 'أزياء يمنية',
                    createdAt: '2024-01-05T00:00:00.000Z',
                    isAutoGenerated: false
                },
                {
                    id: '6',
                    name: 'زي يمني زفافي',
                    price: 25000,
                    description: 'زي يمني فاخر للأعراس، تطريز ذهبي وقماش حريري ملكي.',
                    images: ['https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?w=800&h=1000&fit=crop&q=80'],
                    category: 'أزياء يمنية',
                    createdAt: '2024-01-06T00:00:00.000Z',
                    isAutoGenerated: false
                },
                {
                    id: '7',
                    name: 'درع حديدة أصيل',
                    price: 11000,
                    description: 'درع من الحديدة بتصميم تقليدي، قماش عالي الجودة وتطريز رائع.',
                    images: ['https://images.unsplash.com/photo-1509631179647-0177331693ae?w=800&h=1000&fit=crop&q=80'],
                    category: 'أزياء يمنية',
                    createdAt: '2024-01-07T00:00:00.000Z',
                    isAutoGenerated: false
                },
                {
                    id: '8',
                    name: 'ثوب إب الفاخر',
                    price: 13500,
                    description: 'ثوب من إب بتصميم أنيق، قماش قطني فاخر وتطريز يدوي.',
                    images: ['https://images.unsplash.com/photo-1490481651871-ab68de25d43d?w=800&h=1000&fit=crop&q=80'],
                    category: 'أزياء يمنية',
                    createdAt: '2024-01-08T00:00:00.000Z',
                    isAutoGenerated: false
                },
                {
                    id: '9',
                    name: 'زي المكلا التقليدي',
                    price: 14500,
                    description: 'زي تقليدي من المكلا، يعكس تراث حضرموت الأصيل.',
                    images: ['https://images.unsplash.com/photo-1496747611176-843222e1e57c?w=800&h=1000&fit=crop&q=80'],
                    category: 'أزياء يمنية',
                    createdAt: '2024-01-09T00:00:00.000Z',
                    isAutoGenerated: false
                },
                {
                    id: '10',
                    name: 'ثوب عدني ملكي',
                    price: 16000,
                    description: 'ثوب من عدن بتصميم ملكي، قماش حريري وتطريز ذهبي.',
                    images: ['https://images.unsplash.com/photo-1483985988355-763728e1935b?w=800&h=1000&fit=crop&q=80'],
                    category: 'أزياء يمنية',
                    createdAt: '2024-01-10T00:00:00.000Z',
                    isAutoGenerated: false
                },
                {
                    id: '11',
                    name: 'عباية مخملية سوداء',
                    price: 25000,
                    description: 'عباية نسائية فاخرة من قماش المخمل، تصميم عصري وأنيق للمناسبات.',
                    images: ['https://images.unsplash.com/photo-1595777457583-95e059d581b8?w=800&h=1000&fit=crop&q=80'],
                    category: 'عبايات',
                    createdAt: '2024-01-11T00:00:00.000Z',
                    isAutoGenerated: false
                },
                {
                    id: '12',
                    name: 'عباية حريرية ذهبية',
                    price: 32000,
                    description: 'عباية حريرية بلون ذهبي فاخر، تطريز يدوي رائع.',
                    images: ['https://images.unsplash.com/photo-1539008835657-9e8e9680c956?w=800&h=1000&fit=crop&q=80'],
                    category: 'عبايات',
                    createdAt: '2024-01-12T00:00:00.000Z',
                    isAutoGenerated: false
                },
                {
                    id: '13',
                    name: 'عباية سوداء كلاسيكية',
                    price: 18000,
                    description: 'عباية سوداء كلاسيكية بتصميم بسيط وأنيق.',
                    images: ['https://images.unsplash.com/photo-1566174053879-31528523f8ae?w=800&h=1000&fit=crop&q=80'],
                    category: 'عبايات',
                    createdAt: '2024-01-13T00:00:00.000Z',
                    isAutoGenerated: false
                },
                {
                    id: '14',
                    name: 'عباية مطرزة فاخرة',
                    price: 28000,
                    description: 'عباية مطرزة بتطريز يدوي فاخر، مناسبة للمناسبات الخاصة.',
                    images: ['https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?w=800&h=1000&fit=crop&q=80'],
                    category: 'عبايات',
                    createdAt: '2024-01-14T00:00:00.000Z',
                    isAutoGenerated: false
                },
                {
                    id: '15',
                    name: 'عباية كريب ناعمة',
                    price: 15000,
                    description: 'عباية من قماش الكريب الناعم، مريحة وأنيقة.',
                    images: ['https://images.unsplash.com/photo-1496747611176-843222e1e57c?w=800&h=1000&fit=crop&q=80'],
                    category: 'عبايات',
                    createdAt: '2024-01-15T00:00:00.000Z',
                    isAutoGenerated: false
                },
                {
                    id: '16',
                    name: 'عباية شيفون فاخرة',
                    price: 22000,
                    description: 'عباية من الشيفون الفاخر، خفيفة وأنيقة.',
                    images: ['https://images.unsplash.com/photo-1485968579169-a6e9dc7ed5a6?w=800&h=1000&fit=crop&q=80'],
                    category: 'عبايات',
                    createdAt: '2024-01-16T00:00:00.000Z',
                    isAutoGenerated: false
                },
                {
                    id: '17',
                    name: 'فستان زفاف مودرن',
                    price: 45000,
                    description: 'فستان سهرة طويل بلون لؤلؤي، يناسب الحفلات الكبيرة.',
                    images: ['https://images.unsplash.com/photo-1566174053879-31528523f8ae?w=800&h=1000&fit=crop&q=80'],
                    category: 'فساتين',
                    createdAt: '2024-01-17T00:00:00.000Z',
                    isAutoGenerated: false
                },
                {
                    id: '18',
                    name: 'فستان سهرة أحمر',
                    price: 35000,
                    description: 'فستان سهرة أحمر جذاب، تصميم أنيق للمناسبات.',
                    images: ['https://images.unsplash.com/photo-1595777457583-95e059d581b8?w=800&h=1000&fit=crop&q=80'],
                    category: 'فساتين',
                    createdAt: '2024-01-18T00:00:00.000Z',
                    isAutoGenerated: false
                },
                {
                    id: '19',
                    name: 'فستان كوكتيل قصير',
                    price: 22000,
                    description: 'فستان كوكتيل قصير أنيق، مناسب للحفلات الصغيرة.',
                    images: ['https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?w=800&h=1000&fit=crop&q=80'],
                    category: 'فساتين',
                    createdAt: '2024-01-19T00:00:00.000Z',
                    isAutoGenerated: false
                },
                {
                    id: '20',
                    name: 'فستان خطوبة فاخر',
                    price: 38000,
                    description: 'فستان خطوبة فاخر، تطريز كريستالي رائع.',
                    images: ['https://images.unsplash.com/photo-1496747611176-843222e1e57c?w=800&h=1000&fit=crop&q=80'],
                    category: 'فساتين',
                    createdAt: '2024-01-20T00:00:00.000Z',
                    isAutoGenerated: false
                },
                {
                    id: '21',
                    name: 'عقد فضة يمني قديم',
                    price: 8000,
                    description: 'إكسسوار فضي مستوحى من التراث اليمني القديم، صناعة يدوية.',
                    images: ['https://images.unsplash.com/photo-1535632066927-ab7c9ab60908?w=800&h=1000&fit=crop&q=80'],
                    category: 'إكسسوارات',
                    createdAt: '2024-01-21T00:00:00.000Z',
                    isAutoGenerated: false
                },
                {
                    id: '22',
                    name: 'سوار ذهبي فاخر',
                    price: 15000,
                    description: 'سوار ذهبي عيار 18، تصميم أنيق وراقي.',
                    images: ['https://images.unsplash.com/photo-1594633312681-425c7b97ccd1?w=800&h=1000&fit=crop&q=80'],
                    category: 'إكسسوارات',
                    createdAt: '2024-01-22T00:00:00.000Z',
                    isAutoGenerated: false
                },
                {
                    id: '23',
                    name: 'حلق فضي مطرز',
                    price: 5000,
                    description: 'حلق فضي مطرز بتصميم يمني أصيل.',
                    images: ['https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=800&h=1000&fit=crop&q=80'],
                    category: 'إكسسوارات',
                    createdAt: '2024-01-23T00:00:00.000Z',
                    isAutoGenerated: false
                },
                {
                    id: '24',
                    name: 'خاتم زمرد يمني',
                    price: 22000,
                    description: 'خاتم فضي مزخرف بحجر الزمرد اليمني الأصيل.',
                    images: ['https://images.unsplash.com/photo-1573408301185-9146fe634ad0?w=800&h=1000&fit=crop&q=80'],
                    category: 'إكسسوارات',
                    createdAt: '2024-01-24T00:00:00.000Z',
                    isAutoGenerated: false
                }
            ];

            products = [...defaultProducts];

            // إذا كانت هناك منتجات محفوظة، ندمجها مع الافتراضية
            if (savedProducts) {
                try {
                    const parsed = JSON.parse(savedProducts);
                    if (Array.isArray(parsed) && parsed.length > 0) {
                        // دمج المنتجات المحفوظة مع الافتراضية (بدون تكرار)
                        const existingIds = new Set(products.map(p => p.id));
                        const newProducts = parsed.filter(p => !existingIds.has(p.id));
                        products = [...newProducts, ...products];
                        console.log('✅ تم دمج المنتجات المحفوظة:', newProducts.length, 'منتج جديد');
                    }
                } catch (e) {
                    console.error('❌ خطأ في قراءة المنتجات المحفوظة:', e);
                }
            }

            console.log('✅ إجمالي المنتجات:', products.length, 'منتج');

            // تنفيذ الإضافة التلقائية اليومية
            executeDailyAutoAdd();

            saveProductsToStorage();
            return true;
        }

        // ==================== دالة حفظ المنتجات ====================
        function saveProductsToStorage() {
            try {
                localStorage.setItem('yaman_products', JSON.stringify(products));
                console.log('💾 تم حفظ المنتجات:', products.length, 'منتج');
                return true;
            } catch (e) {
                console.error('❌ خطأ في حفظ المنتجات:', e);
                showToast('خطأ في حفظ المنتجات!');
                return false;
            }
        }

        // ==================== المنتجات الافتراضية (احتياطي) ====================
        function getDefaultProducts() {
            return [
                {
                    id: '1',
                    name: 'درع صنعاني ملكي',
                    price: 15000,
                    description: 'درع صنعاني أصيل مطرز بخيوط الذهب، قماش حرير طبيعي عالي الجودة.',
                    images: ['https://images.unsplash.com/photo-1558171813-4c088753af8f?w=800&h=1000&fit=crop&q=80'],
                    category: 'أزياء يمنية',
                    createdAt: new Date('2024-01-01').toISOString()
                },
                {
                    id: '2',
                    name: 'عباية مخملية سوداء',
                    price: 25000,
                    description: 'عباية نسائية فاخرة من قماش المخمل، تصميم عصري وأنيق للمناسبات.',
                    images: ['https://images.unsplash.com/photo-1595777457583-95e059d581b8?w=800&h=1000&fit=crop&q=80'],
                    category: 'عبايات',
                    createdAt: new Date('2024-01-01').toISOString()
                },
                {
                    id: '3',
                    name: 'فستان زفاف مودرن',
                    price: 45000,
                    description: 'فستان سهرة طويل بلون لؤلؤي، يناسب الحفلات الكبيرة.',
                    images: ['https://images.unsplash.com/photo-1566174053879-31528523f8ae?w=800&h=1000&fit=crop&q=80'],
                    category: 'فساتين',
                    createdAt: new Date('2024-01-01').toISOString()
                },
                {
                    id: '4',
                    name: 'عقد فضة يمني قديم',
                    price: 8000,
                    description: 'إكسسوار فضي مستوحى من التراث اليمني القديم، صناعة يدوية.',
                    images: ['https://images.unsplash.com/photo-1535632066927-ab7c9ab60908?w=800&h=1000&fit=crop&q=80'],
                    category: 'إكسسوارات',
                    createdAt: new Date('2024-01-01').toISOString()
                }
            ];
        }

        // ==================== دوال مساعدة ====================
        function formatPrice(price) {
            return price.toLocaleString('ar-YE') + ' ' + CURRENCY;
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function showToast(message, duration = 3000) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-message').textContent = message;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), duration);
        }

        function isNewProduct(createdAt) {
            const productDate = new Date(createdAt);
            const now = new Date();
            const diffTime = Math.abs(now - productDate);
            const diffHours = Math.ceil(diffTime / (1000 * 60 * 60));
            return diffHours <= 24; // منتجات أقل من 24 ساعة
        }

        // ==================== Lightbox ====================
        function openLightbox(src, images = null, index = 0) {
            if (images) {
                currentLightboxImages = images;
                currentLightboxIndex = index;
            } else {
                currentLightboxImages = [src];
                currentLightboxIndex = 0;
            }
            updateLightboxImage();
            document.getElementById('lightbox').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeLightbox() {
            document.getElementById('lightbox').classList.remove('active');
            document.body.style.overflow = '';
        }

        function updateLightboxImage() {
            const img = document.getElementById('lightbox-img');
            img.src = currentLightboxImages[currentLightboxIndex];
        }

        function changeLightboxImage(direction) {
            currentLightboxIndex += direction;
            if (currentLightboxIndex < 0) {
                currentLightboxIndex = currentLightboxImages.length - 1;
            } else if (currentLightboxIndex >= currentLightboxImages.length) {
                currentLightboxIndex = 0;
            }
            updateLightboxImage();
        }

        // ==================== معرض الصور في تفاصيل المنتج ====================
        let currentDetailImages = [];
        let currentDetailIndex = 0;

        function openProductDetail(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) {
                console.error('❌ المنتج غير موجود:', productId);
                return;
            }

            currentDetailImages = product.images || [product.images[0]];
            currentDetailIndex = 0;

            document.getElementById('detail-name').textContent = product.name;
            document.getElementById('detail-category').textContent = product.category;
            document.getElementById('detail-price').textContent = formatPrice(product.price);
            document.getElementById('detail-description').textContent = product.description;
            document.getElementById('detail-add-to-cart').onclick = () => {
                addToCart(product.id);
                closeProductDetail();
            };

            updateDetailGallery();
            document.getElementById('product-detail-modal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeProductDetail() {
            document.getElementById('product-detail-modal').classList.remove('active');
            document.body.style.overflow = '';
        }

        function updateDetailGallery() {
            const mainImg = document.getElementById('detail-main-image');
            const thumbsContainer = document.getElementById('detail-gallery-thumbs');

            mainImg.src = currentDetailImages[currentDetailIndex];

            thumbsContainer.innerHTML = currentDetailImages.map((img, idx) => `
                <div class="gallery-thumb ${idx === currentDetailIndex ? 'active' : ''}" onclick="selectDetailImage(${idx})">
                    <img src="${img}" alt="صورة ${idx + 1}">
                </div>
            `).join('');
        }

        function selectDetailImage(index) {
            currentDetailIndex = index;
            updateDetailGallery();
        }

        function openGalleryLightbox() {
            openLightbox(null, currentDetailImages, currentDetailIndex);
        }

        // ==================== رفع متعدد الصور (إضافة منتج) ====================
        function handleMultipleImages(input) {
            const files = Array.from(input.files);
            if (files.length === 0) return;

            if (tempProductImages.length + files.length > 8) {
                showToast('الحد الأقصى 8 صور للمنتج');
                return;
            }

            let processedCount = 0;

            files.forEach(file => {
                if (!file.type.startsWith('image/')) {
                    showToast('ملف غير مدعوم: ' + file.name);
                    processedCount++;
                    return;
                }

                if (file.size > 5 * 1024 * 1024) {
                    showToast('حجم كبير جداً (max 5MB): ' + file.name);
                    processedCount++;
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    tempProductImages.push(e.target.result);
                    processedCount++;
                    if (processedCount === files.length) {
                        updateMultiImagePreview();
                    }
                };
                reader.onerror = function() {
                    showToast('خطأ في قراءة الملف: ' + file.name);
                    processedCount++;
                };
                reader.readAsDataURL(file);
            });
        }

        function updateMultiImagePreview() {
            const container = document.getElementById('multi-image-preview');

            if (tempProductImages.length === 0) {
                container.innerHTML = '';
                return;
            }

            container.innerHTML = tempProductImages.map((img, idx) => `
                <div class="preview-item ${idx === 0 ? 'main-image' : ''}" onclick="setMainImage(${idx})">
                    <img src="${img}" alt="صورة ${idx + 1}">
                    <button type="button" class="remove-btn" onclick="event.stopPropagation(); removeTempImage(${idx})">
                        <i class="fa-solid fa-times"></i>
                    </button>
                </div>
            `).join('');
        }

        function setMainImage(index) {
            const selected = tempProductImages.splice(index, 1)[0];
            tempProductImages.unshift(selected);
            updateMultiImagePreview();
            showToast('تم تعيينها كصورة رئيسية');
        }

        function removeTempImage(index) {
            tempProductImages.splice(index, 1);
            updateMultiImagePreview();
        }

        // ==================== رفع متعدد الصور (تعديل منتج) ====================
        function handleEditMultipleImages(input) {
            const files = Array.from(input.files);
            if (files.length === 0) return;

            if (editProductImages.length + files.length > 8) {
                showToast('الحد الأقصى 8 صور للمنتج');
                return;
            }

            let processedCount = 0;

            files.forEach(file => {
                if (!file.type.startsWith('image/')) {
                    showToast('ملف غير مدعوم: ' + file.name);
                    processedCount++;
                    return;
                }

                if (file.size > 5 * 1024 * 1024) {
                    showToast('حجم كبير جداً (max 5MB): ' + file.name);
                    processedCount++;
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    editProductImages.push(e.target.result);
                    processedCount++;
                    if (processedCount === files.length) {
                        updateEditImagePreview();
                    }
                };
                reader.onerror = function() {
                    showToast('خطأ في قراءة الملف: ' + file.name);
                    processedCount++;
                };
                reader.readAsDataURL(file);
            });
        }

        function updateEditImagePreview() {
            const container = document.getElementById('edit-multi-image-preview');

            if (editProductImages.length === 0) {
                container.innerHTML = '';
                return;
            }

            container.innerHTML = editProductImages.map((img, idx) => `
                <div class="preview-item ${idx === 0 ? 'main-image' : ''}" onclick="setEditMainImage(${idx})">
                    <img src="${img}" alt="صورة ${idx + 1}">
                    <button type="button" class="remove-btn" onclick="event.stopPropagation(); removeEditTempImage(${idx})">
                        <i class="fa-solid fa-times"></i>
                    </button>
                </div>
            `).join('');
        }

        function setEditMainImage(index) {
            const selected = editProductImages.splice(index, 1)[0];
            editProductImages.unshift(selected);
            updateEditImagePreview();
            showToast('تم تعيينها كصورة رئيسية');
        }

        function removeEditTempImage(index) {
            editProductImages.splice(index, 1);
            updateEditImagePreview();
        }

        // ==================== إدارة السلة ====================
        function saveCart() {
            localStorage.setItem('yaman_cart', JSON.stringify(cart));
            updateCartUI();
        }

        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) {
                console.error('❌ المنتج غير موجود في السلة:', productId);
                return;
            }

            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({ 
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    image: product.images[0],
                    quantity: 1 
                });
            }
            saveCart();
            showToast('تم إضافة المنتج للسلة ✓');
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            saveCart();
        }

        function updateQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    removeFromCart(productId);
                } else {
                    saveCart();
                }
            }
        }

        function clearCart() {
            cart = [];
            saveCart();
            toggleCart();
        }

        function getCartTotal() {
            return cart.reduce((total, item) => total + (item.price * item.quantity), 0);
        }

        function updateCartUI() {
            const cartCount = document.getElementById('cart-count');
            const cartItems = document.getElementById('cart-items');
            const cartTotal = document.getElementById('cart-total');
            const checkoutBtn = document.getElementById('checkout-btn');
            const clearCartBtn = document.getElementById('clear-cart-btn');

            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);

            if (totalItems > 0) {
                cartCount.textContent = totalItems;
                cartCount.classList.remove('hidden');
                checkoutBtn.disabled = false;
                checkoutBtn.classList.remove('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
                checkoutBtn.classList.add('btn-primary', 'text-white');
                clearCartBtn.classList.remove('hidden');
            } else {
                cartCount.classList.add('hidden');
                checkoutBtn.disabled = true;
                checkoutBtn.classList.add('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
                checkoutBtn.classList.remove('btn-primary', 'text-white');
                clearCartBtn.classList.add('hidden');
            }

            cartTotal.textContent = formatPrice(getCartTotal());

            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="text-center text-gray-500 py-12">
                        <i class="fa-solid fa-cart-shopping text-6xl mb-4 text-gray-300"></i>
                        <p>السلة فارغة</p>
                    </div>
                `;
            } else {
                cartItems.innerHTML = cart.map(item => `
                    <div class="flex gap-4 bg-gray-50 p-4 rounded-lg">
                        <img src="${item.image}" alt="${item.name}" class="w-20 h-20 object-cover rounded-lg cursor-pointer" onclick="openLightbox('${item.image}')">
                        <div class="flex-1">
                            <h4 class="font-bold text-sm mb-1">${item.name}</h4>
                            <p class="text-rose-600 font-bold">${formatPrice(item.price)}</p>
                            <div class="flex items-center gap-2 mt-2">
                                <button onclick="updateQuantity('${item.id}', -1)" class="w-8 h-8 rounded-full bg-gray-200 hover:bg-gray-300 flex items-center justify-center">
                                    <i class="fa-solid fa-minus text-xs"></i>
                                </button>
                                <span class="font-bold">${item.quantity}</span>
                                <button onclick="updateQuantity('${item.id}', 1)" class="w-8 h-8 rounded-full bg-gray-200 hover:bg-gray-300 flex items-center justify-center">
                                    <i class="fa-solid fa-plus text-xs"></i>
                                </button>
                            </div>
                        </div>
                        <button onclick="removeFromCart('${item.id}')" class="text-red-500 hover:text-red-700 self-start">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                `).join('');
            }
        }

        function toggleCart() {
            const drawer = document.getElementById('cart-drawer');
            const overlay = document.getElementById('cart-overlay');
            drawer.classList.toggle('open');
            overlay.classList.toggle('hidden');
            document.body.style.overflow = drawer.classList.contains('open') ? 'hidden' : '';
        }

        // ==================== عرض المنتجات مع معرض الصور ====================
        function createProductCard(product) {
            const isNew = isNewProduct(product.createdAt);
            const newBadge = isNew ? `
                <div class="absolute top-4 left-4 z-10">
                    <span class="new-badge text-white px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1">
                        <i class="fa-solid fa-sparkles"></i> جديد
                    </span>
                </div>
            ` : '';

            const imageCount = product.images ? product.images.length : 0;
            const mainImage = product.images && product.images.length > 0 ? product.images[0] : 'https://via.placeholder.com/600x800?text=No+Image';

            const galleryIndicator = imageCount > 1 ? `
                <div class="absolute bottom-4 left-4 bg-black/60 text-white text-xs px-2 py-1 rounded-full flex items-center gap-1">
                    <i class="fa-solid fa-images"></i> ${imageCount}
                </div>
            ` : '';

            return `
                <div class="product-card bg-white rounded-2xl shadow-lg overflow-hidden group relative">
                    ${newBadge}
                    <div class="hd-image-container h-64" onclick="openProductDetail('${product.id}')">
                        <img src="${mainImage}" alt="${product.name}" class="hd-image" loading="lazy">
                        <div class="zoom-icon">
                            <i class="fa-solid fa-expand"></i>
                        </div>
                        ${galleryIndicator}
                    </div>
                    <div class="p-5">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-xs text-rose-600 bg-rose-50 px-2 py-1 rounded-full">${product.category}</span>
                            ${isNew ? '<span class="text-xs text-green-600 bg-green-50 px-2 py-1 rounded-full">جديد</span>' : ''}
                        </div>
                        <h3 class="font-bold text-lg mb-2 text-gray-800 cursor-pointer hover:text-rose-600 transition" onclick="openProductDetail('${product.id}')">${product.name}</h3>
                        <p class="text-gray-500 text-sm mb-3 line-clamp-2">${product.description}</p>
                        <div class="flex justify-between items-center">
                            <span class="text-rose-600 font-bold text-xl">${formatPrice(product.price)}</span>
                            <button onclick="event.stopPropagation(); addToCart('${product.id}')" class="bg-rose-100 text-rose-600 px-4 py-2 rounded-full text-sm font-bold hover:bg-rose-600 hover:text-white transition">
                                إضافة للسلة
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderFeaturedProducts() {
            const container = document.getElementById('featured-products');
            if (!container) return;

            // عرض أول 4 منتجات (الأحدث لأنها مرتبة حسب التاريخ)
            const featured = products.slice(0, 4);
            container.innerHTML = featured.map(createProductCard).join('');
            console.log('✅ تم عرض المنتجات المميزة:', featured.length, 'منتج');
        }

        function renderAllHomeProducts() {
            const container = document.getElementById('all-home-products');
            if (!container) return;

            // عرض منتجات من 5 إلى 16 (بعد المنتجات المميزة)
            const homeProducts = products.slice(4, 16);
            container.innerHTML = homeProducts.map(createProductCard).join('');
            console.log('✅ تم عرض منتجات الصفحة الرئيسية:', homeProducts.length, 'منتج');
        }

        function renderNewProducts() {
            const newProducts = products.filter(p => isNewProduct(p.createdAt));
            const section = document.getElementById('new-products-section');
            const container = document.getElementById('new-products');

            if (!section || !container) return;

            if (newProducts.length > 0) {
                section.classList.remove('hidden');
                container.innerHTML = newProducts.map(createProductCard).join('');
                console.log('✅ تم عرض المنتجات الجديدة:', newProducts.length, 'منتج');
            } else {
                section.classList.add('hidden');
                console.log('ℹ️ لا توجد منتجات جديدة');
            }
        }

        function renderShopProducts(category = 'all') {
            const container = document.getElementById('shop-products');
            if (!container) return;

            const filtered = category === 'all' ? products : products.filter(p => p.category === category);

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-12 text-gray-500">
                        <i class="fa-solid fa-box-open text-6xl mb-4 text-gray-300"></i>
                        <p>لا توجد منتجات في هذا القسم</p>
                    </div>
                `;
            } else {
                container.innerHTML = filtered.map(createProductCard).join('');
            }
            console.log('✅ تم عرض منتجات المتجر:', filtered.length, 'منتج');
        }

        // ==================== التنقل بين الصفحات ====================
        function hideAllPages() {
            ['home-page', 'shop-page', 'checkout-page', 'admin-login-page', 'admin-dashboard'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.classList.add('hidden');
            });
        }

        function showHome() {
            hideAllPages();
            const homePage = document.getElementById('home-page');
            if (homePage) {
                homePage.classList.remove('hidden');
                renderDailyNewProducts();
                renderAutoProducts();
                renderFeaturedProducts();
                renderAllHomeProducts();
            }
            window.scrollTo(0, 0);
        }

        function showShop(category = 'all') {
            hideAllPages();
            currentCategory = category;
            const shopPage = document.getElementById('shop-page');
            if (shopPage) {
                shopPage.classList.remove('hidden');
                renderShopProducts(category);
            }

            document.querySelectorAll('.category-btn').forEach(btn => {
                if (btn.dataset.category === category) {
                    btn.classList.remove('bg-white', 'text-gray-700', 'border-gray-300');
                    btn.classList.add('bg-rose-600', 'text-white');
                } else {
                    btn.classList.add('bg-white', 'text-gray-700', 'border-gray-300');
                    btn.classList.remove('bg-rose-600', 'text-white');
                }
            });

            window.scrollTo(0, 0);
        }

        function filterProducts(category) {
            showShop(category);
        }

        function showCategories() {
            const el = document.querySelector('#home-page .py-16.px-4.bg-white');
            if (el) el.scrollIntoView({ behavior: 'smooth' });
        }

        function showCheckout() {
            if (cart.length === 0) {
                showToast('السلة فارغة!');
                return;
            }
            toggleCart();
            hideAllPages();
            const checkoutPage = document.getElementById('checkout-page');
            if (checkoutPage) checkoutPage.classList.remove('hidden');

            const container = document.getElementById('checkout-items');
            if (container) {
                container.innerHTML = cart.map(item => `
                    <div class="flex justify-between items-center py-2 border-b">
                        <div class="flex items-center gap-3">
                            <img src="${item.image}" class="w-16 h-16 object-cover rounded-lg cursor-pointer" onclick="openLightbox('${item.image}')">
                            <div>
                                <span class="font-bold block">${item.name}</span>
                                <span class="text-gray-500 text-sm"> × ${item.quantity}</span>
                            </div>
                        </div>
                        <span class="font-bold">${formatPrice(item.price * item.quantity)}</span>
                    </div>
                `).join('');
            }

            const totalEl = document.getElementById('checkout-total');
            if (totalEl) totalEl.textContent = formatPrice(getCartTotal());
            window.scrollTo(0, 0);
        }

        // ==================== إتمام الطلب ====================
        document.getElementById('checkout-form')?.addEventListener('submit', function(e) {
            e.preventDefault();

            const name = document.getElementById('customer-name').value;
            const phone = document.getElementById('customer-phone').value;
            const city = document.getElementById('customer-city').value;
            const notes = document.getElementById('customer-notes').value;

            let message = `*طلب جديد من ${STORE_NAME}* %0A%0A`;
            message += `*العميل:* ${name}%0A`;
            message += `*الجوال:* ${phone}%0A`;
            message += `*المدينة:* ${city}%0A%0A`;
            message += `*الطلبات:*%0A`;

            cart.forEach(item => {
                message += `- ${item.name} (${item.quantity} × ${formatPrice(item.price)})%0A`;
            });

            message += `%0A*الإجمالي:* ${formatPrice(getCartTotal())}%0A`;

            if (notes) message += `%0A*ملاحظات:* ${notes}`;

            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${message}`, '_blank');

            const orders = JSON.parse(localStorage.getItem('yaman_orders') || '[]');
            orders.push({
                id: generateId(),
                customer: { name, phone, city, notes },
                items: [...cart],
                total: getCartTotal(),
                date: new Date().toISOString(),
                status: 'pending'
            });
            localStorage.setItem('yaman_orders', JSON.stringify(orders));

            cart = [];
            saveCart();

            showToast('تم إرسال طلبك! سنتواصل معك قريباً ✓');
            setTimeout(showHome, 2000);
        });

        // ==================== نظام الإدارة ====================
        function checkAdminAccess() {
            const params = new URLSearchParams(window.location.search);
            if (params.has('admin')) {
                window.history.replaceState({}, document.title, window.location.pathname);
                showAdminLogin();
            }
        }

        function showAdminLogin() {
            hideAllPages();
            const loginPage = document.getElementById('admin-login-page');
            if (loginPage) loginPage.classList.remove('hidden');
        }

        document.getElementById('admin-login-form')?.addEventListener('submit', function(e) {
            e.preventDefault();
            const password = document.getElementById('admin-password').value;

            if (password === ADMIN_PASSWORD) {
                sessionStorage.setItem('yaman_admin_auth', 'true');
                showAdminDashboard();
                showToast('تم تسجيل الدخول بنجاح ✓');
            } else {
                showToast('كلمة المرور خاطئة!');
            }
        });

        function showAdminDashboard() {
            if (sessionStorage.getItem('yaman_admin_auth') !== 'true') {
                showAdminLogin();
                return;
            }
            hideAllPages();
            const dashboard = document.getElementById('admin-dashboard');
            if (dashboard) dashboard.classList.remove('hidden');
            updateAdminStats();
            renderAdminProducts();
            loadSettings();
        }

        function adminLogout() {
            sessionStorage.removeItem('yaman_admin_auth');
            showHome();
            showToast('تم تسجيل الخروج');
        }

        function updateAdminStats() {
            const countEl = document.getElementById('admin-products-count');
            const ordersEl = document.getElementById('admin-orders-count');
            const salesEl = document.getElementById('admin-sales-total');

            if (countEl) countEl.textContent = products.length;

            const orders = JSON.parse(localStorage.getItem('yaman_orders') || '[]');
            if (ordersEl) ordersEl.textContent = orders.filter(o => o.status === 'pending').length;

            const totalSales = orders.filter(o => o.status === 'completed').reduce((sum, o) => sum + o.total, 0);
            if (salesEl) salesEl.textContent = formatPrice(totalSales);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-YE');
        }

        function renderAdminProducts() {
            const tbody = document.getElementById('admin-products-table');
            if (!tbody) return;

            tbody.innerHTML = products.map(p => {
                const mainImage = p.images && p.images.length > 0 ? p.images[0] : '';
                const isNew = isNewProduct(p.createdAt);
                const typeBadge = p.isAutoGenerated ? 
                    '<span class="auto-badge"><i class="fa-solid fa-robot"></i> تلقائي</span>' : 
                    '<span class="bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-xs">يدوي</span>';

                return `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="px-4 py-3">
                            <div class="flex items-center gap-3">
                                <img src="${mainImage}" class="w-12 h-12 object-cover rounded-lg cursor-pointer" onclick="openLightbox('${mainImage}')">
                                <span class="font-bold">${p.name}</span>
                                ${isNew ? '<span class="bg-green-500 text-white text-xs px-2 py-1 rounded-full mr-2">جديد</span>' : ''}
                            </div>
                        </td>
                        <td class="px-4 py-3">${p.category}</td>
                        <td class="px-4 py-3 font-bold text-rose-600">${formatPrice(p.price)}</td>
                        <td class="px-4 py-3">
                            <span class="bg-gray-100 text-gray-700 px-2 py-1 rounded-full text-sm">${p.images ? p.images.length : 0} صورة</span>
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-500">${formatDate(p.createdAt)}</td>
                        <td class="px-4 py-3">${typeBadge}</td>
                        <td class="px-4 py-3">
                            <button onclick="openEditProductModal('${p.id}')" class="text-blue-500 hover:text-blue-700 ml-2" title="تعديل">
                                <i class="fa-solid fa-edit"></i>
                            </button>
                            <button onclick="deleteProduct('${p.id}')" class="text-red-500 hover:text-red-700" title="حذف">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // ==================== تعديل المنتج ====================
        function openEditProductModal(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) {
                showToast('المنتج غير موجود!');
                return;
            }

            currentEditProductId = productId;
            editProductImages = product.images ? [...product.images] : [];

            document.getElementById('edit-product-id').value = productId;
            document.getElementById('edit-product-name').value = product.name;
            document.getElementById('edit-product-price').value = product.price;
            document.getElementById('edit-product-category').value = product.category;
            document.getElementById('edit-product-desc').value = product.description || '';

            updateEditImagePreview();

            const modal = document.getElementById('edit-product-modal');
            if (modal) modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeEditProductModal(event) {
            if (event && event.target !== event.currentTarget) return;
            
            const modal = document.getElementById('edit-product-modal');
            if (modal) modal.classList.remove('active');
            document.body.style.overflow = '';
            
            currentEditProductId = null;
            editProductImages = [];
        }

        document.getElementById('edit-product-form')?.addEventListener('submit', function(e) {
            e.preventDefault();

            if (!currentEditProductId) {
                showToast('خطأ: لم يتم تحديد المنتج!');
                return;
            }

            const name = document.getElementById('edit-product-name').value;
            const priceInput = document.getElementById('edit-product-price').value;
            const price = parseInt(priceInput);
            const category = document.getElementById('edit-product-category').value;
            const description = document.getElementById('edit-product-desc').value;

            if (!priceInput || isNaN(price) || price < 0) {
                showToast('الرجاء إدخال سعر صحيح!');
                return;
            }

            if (editProductImages.length === 0) {
                showToast('الرجاء إضافة صورة واحدة على الأقل!');
                return;
            }

            // البحث عن المنتج وتحديثه
            const productIndex = products.findIndex(p => p.id === currentEditProductId);
            if (productIndex === -1) {
                showToast('المنتج غير موجود!');
                return;
            }

            // تحديث بيانات المنتج
            products[productIndex] = {
                ...products[productIndex],
                name,
                price,
                category,
                description,
                images: [...editProductImages]
            };

            // حفظ التغييرات
            saveProductsToStorage();

            // تحديث العرض
            closeEditProductModal();
            renderAdminProducts();
            updateAdminStats();

            // تحديث صفحات الزبائن إذا كانت ظاهرة
            if (!document.getElementById('home-page')?.classList.contains('hidden')) {
                renderNewProducts();
                renderFeaturedProducts();
                renderAllHomeProducts();
            }
            if (!document.getElementById('shop-page')?.classList.contains('hidden')) {
                renderShopProducts(currentCategory);
            }

            showToast(`تم تحديث المنتج "${name}" بنجاح ✓`);
            console.log('✅ تم تعديل المنتج:', products[productIndex]);
        });

        // ==================== إضافة منتج جديد ====================
        function showAddProductForm() {
            const modal = document.getElementById('add-product-modal');
            if (modal) modal.classList.remove('hidden');

            const form = document.getElementById('add-product-form');
            if (form) form.reset();

            tempProductImages = [];
            updateMultiImagePreview();
        }

        function closeAddProductModal() {
            const modal = document.getElementById('add-product-modal');
            if (modal) modal.classList.add('hidden');

            const form = document.getElementById('add-product-form');
            if (form) form.reset();

            tempProductImages = [];
            updateMultiImagePreview();
        }

        document.getElementById('add-product-form')?.addEventListener('submit', function(e) {
            e.preventDefault();

            const name = document.getElementById('new-product-name').value;
            const priceInput = document.getElementById('new-product-price').value;
            const price = parseInt(priceInput);
            const category = document.getElementById('new-product-category').value;
            const description = document.getElementById('new-product-desc').value;

            if (!priceInput || isNaN(price) || price < 0) {
                showToast('الرجاء إدخال سعر صحيح!');
                return;
            }

            if (tempProductImages.length === 0) {
                showToast('الرجاء إضافة صورة واحدة على الأقل!');
                return;
            }

            const newProduct = {
                id: generateId(),
                name,
                price,
                category,
                description,
                images: [...tempProductImages],
                createdAt: new Date().toISOString()
            };

            // ✅ إضافة للمصفوفة وحفظ فوري
            products.push(newProduct);
            saveProductsToStorage();

            // ✅ تحديث فوري لجميع العروض
            closeAddProductModal();
            renderAdminProducts();
            updateAdminStats();

            // تحديث صفحات الزبائن إذا كانت ظاهرة
            if (!document.getElementById('home-page')?.classList.contains('hidden')) {
                renderNewProducts();
                renderFeaturedProducts();
                renderAllHomeProducts();
            }
            if (!document.getElementById('shop-page')?.classList.contains('hidden')) {
                renderShopProducts(currentCategory);
            }

            showToast(`تم إضافة المنتج "${name}" مع ${newProduct.images.length} صورة ✓`);

            console.log('✅ تم إضافة منتج جديد:', newProduct);
            console.log('📊 إجمالي المنتجات الآن:', products.length);
        });

        function deleteProduct(id) {
            if (confirm('هل أنت متأكد من حذف هذا المنتج؟')) {
                products = products.filter(p => p.id !== id);
                saveProductsToStorage();
                renderAdminProducts();
                updateAdminStats();
                renderDailyNewProducts();
                renderAutoProducts();
                renderFeaturedProducts();
                renderAllHomeProducts();
                renderShopProducts(currentCategory);
                showToast('تم حذف المنتج');
            }
        }

        function loadSettings() {
            const savedWhatsapp = localStorage.getItem('yaman_whatsapp');
            const savedPassword = localStorage.getItem('yaman_password');

            const whatsappInput = document.getElementById('settings-whatsapp');
            if (whatsappInput) {
                if (savedWhatsapp) {
                    WHATSAPP_NUMBER = savedWhatsapp;
                    whatsappInput.value = savedWhatsapp;
                } else {
                    whatsappInput.value = WHATSAPP_NUMBER;
                }
            }

            if (savedPassword) {
                ADMIN_PASSWORD = savedPassword;
            }
        }

        function saveSettings() {
            const newWhatsapp = document.getElementById('settings-whatsapp')?.value.trim();
            const newPassword = document.getElementById('settings-password')?.value;

            if (newWhatsapp) {
                WHATSAPP_NUMBER = newWhatsapp.replace(/[^0-9]/g, '');
                localStorage.setItem('yaman_whatsapp', WHATSAPP_NUMBER);
                const waLink = document.querySelector('.whatsapp-float');
                if (waLink) waLink.href = `https://wa.me/${WHATSAPP_NUMBER}`;
            }

            if (newPassword) {
                ADMIN_PASSWORD = newPassword;
                localStorage.setItem('yaman_password', newPassword);
            }

            showToast('تم حفظ الإعدادات بنجاح ✓');
            const pwdInput = document.getElementById('settings-password');
            if (pwdInput) pwdInput.value = '';
        }

        // ==================== التهيئة الرئيسية ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 بدء تشغيل المتجر...');

            // ✅ تحميل المنتجات أولاً
            loadProductsFromStorage();

            // ✅ تحميل الإعدادات
            const savedWhatsapp = localStorage.getItem('yaman_whatsapp');
            if (savedWhatsapp) WHATSAPP_NUMBER = savedWhatsapp;

            const savedPassword = localStorage.getItem('yaman_password');
            if (savedPassword) ADMIN_PASSWORD = savedPassword;

            const waLink = document.querySelector('.whatsapp-float');
            if (waLink) waLink.href = `https://wa.me/${WHATSAPP_NUMBER}`;

            // ✅ تهيئة العرض
            renderDailyNewProducts();
            renderAutoProducts();
            renderFeaturedProducts();
            renderAllHomeProducts();
            updateCartUI();
            checkAdminAccess();

            console.log('✅ تم تهيئة المتجر بنجاح!');
            console.log('📦 عدد المنتجات:', products.length);
            console.log('🛒 عدد عناصر السلة:', cart.length);
        });

        window.addEventListener('popstate', function() {
            if (sessionStorage.getItem('yaman_admin_auth') === 'true' && !window.location.search.includes('admin')) {
                sessionStorage.removeItem('yaman_admin_auth');
            }
        });
    </script>

</body>
</html>
